<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFB Grambling</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0f1c;
            color: white;
            padding-bottom: 80px; /* Space for bottom bet slip */
        }
        
        /* Navigation Bubbles */
        .nav-bubbles {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
            position: sticky;
            top: 0;
            z-index: 100;
            overflow-x: auto;
        }
        
        .nav-left {
            display: flex;
            gap: 0.75rem;
            flex: 1;
        }
        
        .logout-btn {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: #fca5a5;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .logout-btn:hover {
            background: rgba(220, 38, 38, 0.3);
        }
        
        .nav-bubble {
            background: rgba(51, 65, 85, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .nav-bubble:hover {
            background: rgba(71, 85, 105, 0.6);
        }
        
        .nav-bubble.active {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            border-color: #1d4ed8;
            color: white;
        }
        
        .nav-bubble.admin {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-color: #dc2626;
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Game Cards - FanDuel Style */
        .game-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.4);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            overflow: hidden;
        }
        
        .game-header {
            background: rgba(15, 23, 42, 0.8);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(71, 85, 105, 0.4);
        }
        
        .game-matchup {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.95rem;
        }
        
        .game-time {
            color: #94a3b8;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        
        .team-row {
            display: grid;
            grid-template-columns: 1fr auto auto auto;
            align-items: center;
            padding: 0.75rem 1rem;
            gap: 0.75rem;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
        }
        
        .team-row:last-child {
            border-bottom: none;
        }
        
        .team-name {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.9rem;
        }
        
        .bet-option {
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.8rem;
            font-weight: 500;
            text-align: center;
            min-width: 65px;
        }
        
        .bet-option:hover {
            background: rgba(71, 85, 105, 0.5);
            border-color: rgba(100, 116, 139, 0.6);
        }
        
        .bet-option.selected {
            background: #1d4ed8;
            border-color: #1d4ed8;
            color: white;
        }
        
        /* Bottom Bet Slip */
        .bet-slip-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(71, 85, 105, 0.5);
            padding: 1rem;
            z-index: 200;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .bet-slip-bar.has-bets {
            background: rgba(29, 78, 216, 0.95);
        }
        
        .bet-slip-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bet-count {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .bet-total {
            font-size: 0.9rem;
            color: #cbd5e1;
        }
        
        /* Bet Slip Modal */
        .bet-slip-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 300;
            display: none;
        }
        
        .bet-slip-content {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.98);
            border-radius: 1rem;
            max-height: 70vh;
            overflow-y: auto;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .bet-slip-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(71, 85, 105, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bet-slip-title {
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .close-bet-slip {
            background: rgba(71, 85, 105, 0.4);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .bet-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
        }
        
        .bet-item:last-of-type {
            border-bottom: none;
        }
        
        .bet-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .bet-info {
            flex: 1;
        }
        
        .bet-team {
            font-weight: 600;
            color: #e2e8f0;
            font-size: 0.9rem;
        }
        
        .bet-details {
            color: #94a3b8;
            font-size: 0.8rem;
        }
        
        .bet-remove {
            background: rgba(220, 38, 38, 0.2);
            border: none;
            color: #fca5a5;
            padding: 0.25rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .bet-amount-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .bet-amount-input {
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 0.25rem;
            padding: 0.4rem;
            color: white;
            width: 80px;
            font-size: 0.85rem;
            text-align: center;
        }
        
        .bet-amount-input:focus {
            outline: none;
            border-color: #1d4ed8;
        }
        
        .bet-winnings {
            color: #6ee7b7;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .bet-slip-footer {
            padding: 1rem;
            background: rgba(30, 41, 59, 0.6);
        }
        
        .requirements {
            background: rgba(71, 85, 105, 0.3);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }
        
        .requirement-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }
        
        .requirement-row:last-child {
            margin-bottom: 0;
        }
        
        .req-label {
            color: #94a3b8;
        }
        
        .req-value {
            color: #e2e8f0;
            font-weight: 600;
        }
        
        .req-value.error {
            color: #fca5a5;
        }
        
        .req-value.success {
            color: #6ee7b7;
        }
        
        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #16a34a, #15803d);
            border: none;
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .submit-btn:disabled {
            background: rgba(71, 85, 105, 0.4);
            color: #94a3b8;
            cursor: not-allowed;
        }
        
        .validation-message {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #fbbf24;
            padding: 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 0.5rem;
        }
        
        .success-message {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #6ee7b7;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            margin: 1rem 0;
        }
        
        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .auth-card {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            backdrop-filter: blur(20px);
        }
        
        .auth-title {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .input-group {
            margin-bottom: 1rem;
        }
        
        .label {
            display: block;
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .input {
            width: 100%;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 0.5rem;
            padding: 0.75rem;
            color: white;
            font-size: 1rem;
        }
        
        .input:focus {
            outline: none;
            border-color: #1d4ed8;
        }
        
        .input::placeholder {
            color: #64748b;
        }
        
        .btn {
            width: 100%;
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            border: none;
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            background: rgba(71, 85, 105, 0.4);
            color: #94a3b8;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            background: rgba(71, 85, 105, 0.4);
            border: 1px solid rgba(100, 116, 139, 0.4);
        }
        
        .error {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid rgba(220, 38, 38, 0.3);
            color: #fca5a5;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .admin-notice {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: #fbbf24;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.85rem;
            margin-top: 1rem;
            text-align: center;
        }
        
        .hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-bubbles {
                gap: 0.5rem;
                padding: 0.75rem 0.5rem;
            }
            
            .nav-bubble {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .container {
                padding: 0.75rem;
            }
            
            .team-row {
                grid-template-columns: 1fr auto auto auto;
                gap: 0.5rem;
            }
            
            .bet-option {
                min-width: 55px;
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="nav-bubbles">
        <div class="nav-left">
            <div class="nav-bubble active" onclick="showPage('thisWeek')">This Week</div>
            <div class="nav-bubble" onclick="showPage('myBets')">My Bets</div>
            <div class="nav-bubble" onclick="showPage('currentWeekBets')">Current Week's Bets</div>
            <div class="nav-bubble" onclick="showPage('leaderboard')">Leaderboard</div>
            <div class="nav-bubble admin hidden" id="adminNav" onclick="showPage('admin')">Admin</div>
            <div class="nav-bubble" onclick="showPage('settings')">Settings</div>
        </div>
        <button class="logout-btn" onclick="handleLogout()">Logout</button>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- This Week Page -->
        <div id="thisWeek" class="page active">
            <div id="gamesContainer">
                <!-- Sample Game Card -->
                <div class="game-card">
                    <div class="game-header">
                        <div class="game-matchup">Georgia @ Alabama</div>
                        <div class="game-time">Saturday, Sep 7 • 3:30 PM ET</div>
                    </div>
                    
                    <div class="team-row">
                        <div class="team-name">Georgia</div>
                        <div class="bet-option" onclick="selectBet('game1', 'Georgia', 'moneyline', '-150')" data-bet="game1-georgia-ml">-150</div>
                        <div class="bet-option" onclick="selectBet('game1', 'Georgia', 'spread', '-3.5 (-110)')" data-bet="game1-georgia-spread">-3.5</div>
                        <div class="bet-option" onclick="selectBet('game1', 'Over', 'total', 'O52.5 (-110)')" data-bet="game1-over">O52.5</div>
                    </div>
                    
                    <div class="team-row">
                        <div class="team-name">Alabama</div>
                        <div class="bet-option" onclick="selectBet('game1', 'Alabama', 'moneyline', '+130')" data-bet="game1-alabama-ml">+130</div>
                        <div class="bet-option" onclick="selectBet('game1', 'Alabama', 'spread', '+3.5 (-110)')" data-bet="game1-alabama-spread">+3.5</div>
                        <div class="bet-option" onclick="selectBet('game1', 'Under', 'total', 'U52.5 (-110)')" data-bet="game1-under">U52.5</div>
                    </div>
                </div>

                <div class="game-card">
                    <div class="game-header">
                        <div class="game-matchup">Texas @ Michigan</div>
                        <div class="game-time">Saturday, Sep 7 • 7:30 PM ET</div>
                    </div>
                    
                    <div class="team-row">
                        <div class="team-name">Texas</div>
                        <div class="bet-option" onclick="selectBet('game2', 'Texas', 'moneyline', '-120')" data-bet="game2-texas-ml">-120</div>
                        <div class="bet-option" onclick="selectBet('game2', 'Texas', 'spread', '-2.5 (-110)')" data-bet="game2-texas-spread">-2.5</div>
                        <div class="bet-option" onclick="selectBet('game2', 'Over', 'total', 'O45.5 (-110)')" data-bet="game2-over">O45.5</div>
                    </div>
                    
                    <div class="team-row">
                        <div class="team-name">Michigan</div>
                        <div class="bet-option" onclick="selectBet('game2', 'Michigan', 'moneyline', '+100')" data-bet="game2-michigan-ml">+100</div>
                        <div class="bet-option" onclick="selectBet('game2', 'Michigan', 'spread', '+2.5 (-110)')" data-bet="game2-michigan-spread">+2.5</div>
                        <div class="bet-option" onclick="selectBet('game2', 'Under', 'total', 'U45.5 (-110)')" data-bet="game2-under">U45.5</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Bets Page -->
        <div id="myBets" class="page">
            <h2 style="margin-bottom: 1rem; color: #e2e8f0;">My Betting History</h2>
            <p style="color: #94a3b8; margin-bottom: 2rem;">View all your bets and edit current week selections</p>
            <div style="text-align: center; color: #64748b; padding: 2rem;">
                Coming Soon - Your betting history will appear here
            </div>
        </div>

        <!-- Current Week's Bets Page -->
        <div id="currentWeekBets" class="page">
            <h2 style="margin-bottom: 1rem; color: #e2e8f0;">This Week's Bets</h2>
            <p style="color: #94a3b8; margin-bottom: 2rem;">See everyone's picks (available after Friday 11 AM ET)</p>
            <div style="text-align: center; color: #64748b; padding: 2rem;">
                Bets will be revealed after the betting deadline
            </div>
        </div>

        <!-- Leaderboard Page -->
        <div id="leaderboard" class="page">
            <h2 style="margin-bottom: 1rem; color: #e2e8f0;">Season Leaderboard</h2>
            <p style="color: #94a3b8; margin-bottom: 2rem;">Current standings and point totals</p>
            <div style="text-align: center; color: #64748b; padding: 2rem;">
                Leaderboard will appear here once points are awarded
            </div>
        </div>

        <!-- Admin Page -->
        <div id="admin" class="page">
            <h2 style="margin-bottom: 1rem; color: #e2e8f0;">Admin Panel</h2>
            
            <div style="display: grid; gap: 2rem; margin-top: 2rem;">
                <div style="background: rgba(30, 41, 59, 0.6); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid rgba(71, 85, 105, 0.4);">
                    <h3 style="margin-bottom: 1rem; color: #e2e8f0;">Load Weekly Odds</h3>
                    <p style="color: #94a3b8; margin-bottom: 1rem; font-size: 0.9rem;">Pull fresh betting lines from the API</p>
                    <button class="btn" onclick="loadOdds()" id="loadOddsBtn">Load Odds</button>
                </div>
                
                <div style="background: rgba(30, 41, 59, 0.6); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid rgba(71, 85, 105, 0.4);">
                    <h3 style="margin-bottom: 1rem; color: #e2e8f0;">Award Points</h3>
                    <p style="color: #94a3b8; margin-bottom: 1rem; font-size: 0.9rem;">Add or subtract points for weekly winners</p>
                    <div style="text-align: center; color: #64748b; padding: 1rem;">
                        Points system coming soon
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings" class="page">
            <h2 style="margin-bottom: 1rem; color: #e2e8f0;">Game Rules</h2>
            
            <div style="background: rgba(30, 41, 59, 0.6); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid rgba(71, 85, 105, 0.4); line-height: 1.6;">
                <h3 style="color: #e2e8f0; margin-bottom: 1rem;">How CFB Grambling Works</h3>
                
                <div style="color: #cbd5e1; margin-bottom: 1.5rem;">
                    <h4 style="color: #e2e8f0; margin-bottom: 0.5rem;">Weekly Betting</h4>
                    <ul style="margin-left: 1.5rem; color: #94a3b8;">
                        <li>New odds loaded every Tuesday at 3 PM ET</li>
                        <li>Place bets until Friday 11 AM ET deadline</li>
                        <li>Must bet exactly $20 total in fake money</li>
                        <li>Choose 3-5 games minimum</li>
                        <li>Minimum $3 per individual bet</li>
                    </ul>
                </div>
                
                <div style="color: #cbd5e1; margin-bottom: 1.5rem;">
                    <h4 style="color: #e2e8f0; margin-bottom: 0.5rem;">Betting Options</h4>
                    <ul style="margin-left: 1.5rem; color: #94a3b8;">
                        <li>Moneyline OR Spread (not both for same game)</li>
                        <li>Over/Under totals (can combine with moneyline/spread)</li>
                        <li>Edit your bets anytime before Friday deadline</li>
                        <li>No peeking at others' bets until after deadline</li>
                    </ul>
                </div>
                
                <div style="color: #cbd5e1;">
                    <h4 style="color: #e2e8f0; margin-bottom: 0.5rem;">Scoring & Points</h4>
                    <ul style="margin-left: 1.5rem; color: #94a3b8;">
                        <li>Weekly winner gets 3 points</li>
                        <li>Second place gets 2 points</li>
                        <li>Third place gets 1 point</li>
                        <li>Points accumulate for season leaderboard</li>
                        <li>Admins award points based on weekly winnings</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Bet Slip Bar -->
    <div class="bet-slip-bar" id="betSlipBar" onclick="openBetSlip()">
        <div class="bet-slip-summary">
            <div class="bet-count" id="betCountDisplay">Bet Slip</div>
            <div class="bet-total" id="betTotalDisplay">Select bets to get started</div>
        </div>
    </div>

    <!-- Bet Slip Modal -->
    <div class="bet-slip-modal" id="betSlipModal">
        <div class="bet-slip-content">
            <div class="bet-slip-header">
                <div class="bet-slip-title">Bet Slip</div>
                <button class="close-bet-slip" onclick="closeBetSlip()">×</button>
            </div>
            
            <div id="betSlipItems">
                <div style="text-align: center; color: #64748b; padding: 1.5rem;">
                    No bets selected
                </div>
            </div>
            
            <div class="bet-slip-footer">
                <div class="requirements">
                    <div class="requirement-row">
                        <span class="req-label">Games:</span>
                        <span class="req-value" id="gamesReq">0 selected</span>
                    </div>
                    <div class="requirement-row">
                        <span class="req-label">Total:</span>
                        <span class="req-value" id="totalReq">$0.00</span>
                    </div>
                    <div class="requirement-row">
                        <span class="req-label">Remaining:</span>
                        <span class="req-value" id="remainingReq">$20.00</span>
                    </div>
                </div>
                
                <button class="submit-btn" id="submitBtn" disabled onclick="submitBets()">Submit Bets</button>
                
                <div id="validationMessage" class="validation-message hidden"></div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-card">
            <div class="auth-title">🏈 CFB Grambling</div>
            
            <div id="loginForm">
                <div class="input-group">
                    <label class="label">Your PIN</label>
                    <input type="text" id="loginPin" class="input" placeholder="Enter your PIN">
                </div>
                <button class="btn" onclick="handleLogin()" id="loginBtn">Login</button>
                <button class="btn btn-secondary" onclick="showRegisterForm()">Create Account</button>
            </div>
            
            <div id="registerForm" class="hidden">
                <div class="input-group">
                    <label class="label">Unique PIN (4+ digits)</label>
                    <input type="text" id="registerPin" class="input" placeholder="Enter your unique PIN">
                </div>
                <div class="input-group">
                    <label class="label">Display Name</label>
                    <input type="text" id="registerName" class="input" placeholder="Enter your name">
                </div>
                <button class="btn" onclick="handleRegister()" id="registerBtn">Create Account</button>
                <button class="btn btn-secondary" onclick="showLoginForm()">Back to Login</button>
            </div>
            
            <div id="authError" class="error hidden"></div>
        </div>
    </div>

    <script>
        // Supabase setup
        const SUPABASE_URL = 'https://bumxibdfhturlljvqfnn.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ1bXhpYmRmaHR1cmxsanZxZm5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjA2NDMsImV4cCI6MjA3MjIzNjY0M30.3B2SHPrDWYGTYLXUieEoO2Nx40CoOlUD_B-8uIKw21s';
        const ODDS_API_KEY = '5ac6ca934f3164bd862f5d44907f11f4';
        
        // Global state
        let currentUser = null;
        let supabase = null;
        let betSlip = [];
        let currentWeek = null;
        
        // Initialize app
        window.addEventListener('DOMContentLoaded', () => {
            initializeSupabase();
            checkAuth();
        });
        
        function initializeSupabase() {
            try {
                if (window.supabase && window.supabase.createClient) {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                    console.log('Supabase initialized successfully');
                } else {
                    setTimeout(initializeSupabase, 100);
                }
            } catch (error) {
                console.error('Supabase initialization error:', error);
            }
        }
        
        function checkAuth() {
            const savedUser = localStorage.getItem('cfb_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                hideAuthModal();
                updateUserDisplay();
            } else {
                showAuthModal();
            }
        }
        
        function updateUserDisplay() {
            if (currentUser?.is_admin) {
                document.getElementById('adminNav').classList.remove('hidden');
            }
        }
        
        // Auth Functions
        function showAuthModal() {
            document.getElementById('authModal').style.display = 'flex';
        }
        
        function hideAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }
        
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            clearAuthError();
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            clearAuthError();
        }
        
        function clearAuthError() {
            document.getElementById('authError').classList.add('hidden');
        }
        
        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }
        
        async function handleLogin() {
            const pin = document.getElementById('loginPin').value.trim();
            const btn = document.getElementById('loginBtn');
            
            clearAuthError();
            
            if (!supabase) {
                showAuthError('System not ready. Please wait a moment and try again.');
                return;
            }
            
            if (!pin) {
                showAuthError('Please enter your PIN');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Logging in...';
            
            try {
                const { data, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('pin', pin);
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    showAuthError('No account found with this PIN');
                    return;
                }
                
                currentUser = data[0];
                localStorage.setItem('cfb_user', JSON.stringify(currentUser));
                hideAuthModal();
                updateUserDisplay();
                
            } catch (err) {
                showAuthError('Login failed: ' + err.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Login';
            }
        }
        
        async function handleRegister() {
            const pin = document.getElementById('registerPin').value.trim();
            const name = document.getElementById('registerName').value.trim();
            const btn = document.getElementById('registerBtn');
            
            clearAuthError();
            
            if (!supabase) {
                showAuthError('System not ready. Please wait a moment and try again.');
                return;
            }
            
            if (!pin || !name) {
                showAuthError('Please fill in all fields');
                return;
            }
            
            if (pin.length < 4) {
                showAuthError('PIN must be at least 4 digits');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Creating Account...';
            
            try {
                const { data: existingUser } = await supabase
                    .from('users')
                    .select('pin')
                    .eq('pin', pin);
                
                if (existingUser && existingUser.length > 0) {
                    showAuthError('This PIN is already taken. Please choose another.');
                    return;
                }
                
                const isAdmin = pin === '7717' || pin === '3669';
                
                const { data, error } = await supabase
                    .from('users')
                    .insert([{
                        pin: pin,
                        name: name,
                        is_admin: isAdmin,
                        total_points: 0
                    }])
                    .select();
                
                if (error) throw error;
                
                currentUser = data[0];
                localStorage.setItem('cfb_user', JSON.stringify(currentUser));
                hideAuthModal();
                updateUserDisplay();
                
            } catch (err) {
                showAuthError('Registration failed: ' + err.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Create Account';
            }
        }
        
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('cfb_user');
            betSlip = [];
            updateBetSlip();
            clearAllSelections();
            document.getElementById('adminNav').classList.add('hidden');
            showAuthModal();
        }
        
        // Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active from nav bubbles
            document.querySelectorAll('.nav-bubble').forEach(bubble => {
                bubble.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Activate nav bubble
            event.target.classList.add('active');
        }
        
        // Betting Logic
        function selectBet(gameId, team, type, odds) {
            const betKey = `${gameId}-${team.toLowerCase().replace(/\s+/g, '')}-${type}`;
            const betElement = document.querySelector(`[data-bet="${betKey}"]`);
            
            if (!betElement) return;
            
            // Check if already selected
            const existingBetIndex = betSlip.findIndex(bet => bet.key === betKey);
            
            if (existingBetIndex >= 0) {
                // Remove the bet
                betSlip.splice(existingBetIndex, 1);
                betElement.classList.remove('selected');
            } else {
                // Check bet limits
                if (betSlip.length >= 5) {
                    showValidationMessage('Maximum 5 bets allowed');
                    return;
                }
                
                // Remove conflicting bets for this game
                removeConflictingBets(gameId, type);
                
                // Override over/under odds to -110
                let finalOdds = odds;
                if (type === 'total') {
                    if (odds.includes('O') || odds.includes('U')) {
                        const point = odds.match(/[OU](\d+\.?\d*)/)?.[1];
                        finalOdds = odds.includes('O') ? `O${point} (-110)` : `U${point} (-110)`;
                    }
                }
                
                // Add the bet
                const bet = {
                    key: betKey,
                    gameId: gameId,
                    team: team,
                    type: type,
                    odds: finalOdds,
                    amount: 3
                };
                
                betSlip.push(bet);
                betElement.classList.add('selected');
            }
            
            updateBetSlip();
            validateBets();
        }
        
        function removeConflictingBets(gameId, newType) {
            const toRemove = [];
            
            betSlip.forEach((bet, index) => {
                if (bet.gameId === gameId) {
                    // Can't have both moneyline and spread
                    if ((newType === 'moneyline' && bet.type === 'spread') ||
                        (newType === 'spread' && bet.type === 'moneyline')) {
                        toRemove.push(index);
                    }
                    // Can't have both over and under
                    if (newType === 'total' && bet.type === 'total') {
                        toRemove.push(index);
                    }
                }
            });
            
            toRemove.reverse().forEach(index => {
                const removedBet = betSlip[index];
                const removedElement = document.querySelector(`[data-bet="${removedBet.key}"]`);
                if (removedElement) {
                    removedElement.classList.remove('selected');
                }
                betSlip.splice(index, 1);
            });
        }
        
        function removeBet(index) {
            if (index >= 0 && index < betSlip.length) {
                const bet = betSlip[index];
                const betElement = document.querySelector(`[data-bet="${bet.key}"]`);
                if (betElement) {
                    betElement.classList.remove('selected');
                }
                betSlip.splice(index, 1);
                updateBetSlip();
                validateBets();
            }
        }
        
        function updateBetAmount(index, amount) {
            const numAmount = parseFloat(amount);
            if (numAmount >= 3 && index >= 0 && index < betSlip.length) {
                betSlip[index].amount = numAmount;
                updateBetSlipSummary();
                validateBets();
            }
        }
        
        function calculateWinnings(odds, amount) {
            const numAmount = parseFloat(amount);
            
            // Parse odds
            if (odds.includes('(') && odds.includes(')')) {
                const oddsMatch = odds.match(/\(([+-]\d+)\)/);
                if (oddsMatch) {
                    odds = oddsMatch[1];
                }
            }
            
            const numOdds = parseInt(odds);
            
            if (numOdds > 0) {
                // Positive odds: (odds/100) * amount
                return (numOdds / 100) * numAmount;
            } else {
                // Negative odds: (100/abs(odds)) * amount
                return (100 / Math.abs(numOdds)) * numAmount;
            }
        }
        
        function updateBetSlip() {
            const betSlipBar = document.getElementById('betSlipBar');
            const betCountDisplay = document.getElementById('betCountDisplay');
            const betTotalDisplay = document.getElementById('betTotalDisplay');
            const betSlipItems = document.getElementById('betSlipItems');
            
            // Update bottom bar
            if (betSlip.length === 0) {
                betSlipBar.classList.remove('has-bets');
                betCountDisplay.textContent = 'Bet Slip';
                betTotalDisplay.textContent = 'Select bets to get started';
            } else {
                betSlipBar.classList.add('has-bets');
                betCountDisplay.textContent = `${betSlip.length} bet${betSlip.length !== 1 ? 's' : ''}`;
                const total = betSlip.reduce((sum, bet) => sum + (bet.amount || 0), 0);
                betTotalDisplay.textContent = `${total.toFixed(2)} / $20.00`;
            }
            
            // Update modal content
            if (betSlip.length === 0) {
                betSlipItems.innerHTML = '<div style="text-align: center; color: #64748b; padding: 1.5rem;">No bets selected</div>';
            } else {
                betSlipItems.innerHTML = betSlip.map((bet, index) => {
                    const winnings = calculateWinnings(bet.odds, bet.amount);
                    return `
                        <div class="bet-item">
                            <div class="bet-row">
                                <div class="bet-info">
                                    <div class="bet-team">${bet.team}</div>
                                    <div class="bet-details">${bet.type.toUpperCase()} • ${bet.odds}</div>
                                </div>
                                <button class="bet-remove" onclick="removeBet(${index})">×</button>
                            </div>
                            <div class="bet-amount-row">
                                <span style="color: #94a3b8; font-size: 0.8rem;">Wager:</span>
                                <input type="number" 
                                       class="bet-amount-input" 
                                       min="3" 
                                       max="20" 
                                       step="0.01" 
                                       value="${bet.amount}"
                                       onchange="updateBetAmount(${index}, this.value)">
                                <span class="bet-winnings">Win: ${winnings.toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            updateBetSlipSummary();
        }
        
        function updateBetSlipSummary() {
            const total = betSlip.reduce((sum, bet) => sum + (bet.amount || 0), 0);
            const remaining = 20 - total;
            
            // Update requirements display
            const gamesReq = document.getElementById('gamesReq');
            const totalReq = document.getElementById('totalReq');
            const remainingReq = document.getElementById('remainingReq');
            
            // Games requirement
            if (betSlip.length < 3) {
                gamesReq.textContent = `${betSlip.length} selected (need ${3 - betSlip.length} more)`;
                gamesReq.className = 'req-value error';
            } else if (betSlip.length > 5) {
                gamesReq.textContent = `${betSlip.length} selected (${betSlip.length - 5} over limit)`;
                gamesReq.className = 'req-value error';
            } else {
                gamesReq.textContent = `${betSlip.length} selected ✓`;
                gamesReq.className = 'req-value success';
            }
            
            // Total requirement
            totalReq.textContent = `${total.toFixed(2)}`;
            if (total === 20) {
                totalReq.className = 'req-value success';
            } else {
                totalReq.className = 'req-value error';
            }
            
            // Remaining requirement
            remainingReq.textContent = `${remaining.toFixed(2)}`;
            if (remaining === 0) {
                remainingReq.className = 'req-value success';
            } else if (remaining < 0) {
                remainingReq.className = 'req-value error';
            } else {
                remainingReq.className = 'req-value';
            }
        }
        
        function validateBets() {
            const total = betSlip.reduce((sum, bet) => sum + (bet.amount || 0), 0);
            const submitBtn = document.getElementById('submitBtn');
            const validationMessage = document.getElementById('validationMessage');
            
            let isValid = true;
            let message = '';
            
            if (betSlip.length < 3) {
                isValid = false;
                message = `Select at least 3 games (currently ${betSlip.length})`;
            } else if (betSlip.length > 5) {
                isValid = false;
                message = `Maximum 5 games allowed (currently ${betSlip.length})`;
            } else if (total !== 20) {
                isValid = false;
                if (total < 20) {
                    message = `Add ${(20 - total).toFixed(2)} more to reach $20`;
                } else {
                    message = `Remove ${(total - 20).toFixed(2)} to reach $20`;
                }
            } else if (betSlip.some(bet => (bet.amount || 0) < 3)) {
                isValid = false;
                message = 'All bets must be at least $3';
            }
            
            submitBtn.disabled = !isValid;
            
            if (message) {
                validationMessage.textContent = message;
                validationMessage.classList.remove('hidden');
            } else {
                validationMessage.classList.add('hidden');
            }
        }(index);
                    }
                }
            });
            
            toRemove.reverse().forEach(index => {
                const removedBet = betSlip[index];
                document.querySelector(`[data-bet="${removedBet.key}"]`).classList.remove('selected');
                betSlip.splice(index, 1);
            });
        }
        
        function removeBet(index) {
            const bet = betSlip[index];
            document.querySelector(`[data-bet="${bet.key}"]`).classList.remove('selected');
            betSlip.splice(index, 1);
            updateBetSlip();
            validateBets();
        }
        
        function updateBetAmount(index, amount) {
            if (amount >= 3) {
                betSlip[index].amount = parseFloat(amount);
                updateBetSlipSummary();
                validateBets();
            }
        }
        
        function updateBetSlip() {
            const betSlipBar = document.getElementById('betSlipBar');
            const betCountDisplay = document.getElementById('betCountDisplay');
            const betTotalDisplay = document.getElementById('betTotalDisplay');
            const betSlipItems = document.getElementById('betSlipItems');
            
            // Update bottom bar
            if (betSlip.length === 0) {
                betSlipBar.classList.remove('has-bets');
                betCountDisplay.textContent = 'Bet Slip';
                betTotalDisplay.textContent = 'Select bets to get started';
            } else {
                betSlipBar.classList.add('has-bets');
                betCountDisplay.textContent = `${betSlip.length} bet${betSlip.length !== 1 ? 's' : ''}`;
                const total = betSlip.reduce((sum, bet) => sum + (bet.amount || 0), 0);
                betTotalDisplay.textContent = `${total.toFixed(2)} / $20.00`;
            }
            
            // Update modal content
            if (betSlip.length === 0) {
                betSlipItems.innerHTML = '<div style="text-align: center; color: #64748b; padding: 2rem;">No bets selected</div>';
            } else {
                betSlipItems.innerHTML = betSlip.map((bet, index) => `
                    <div class="bet-item">
                        <div class="bet-item-header">
                            <div class="bet-team">${bet.team}</div>
                            <div class="bet-type">${bet.type.toUpperCase()}</div>
                            <button class="remove-bet" onclick="removeBet(${index})">Remove</button>
                        </div>
                        <div class="bet-odds">${bet.odds}</div>
                        <input type="number" 
                               class="bet-amount-input" 
                               min="3" 
                               max="20" 
                               step="0.01" 
                               value="${bet.amount}"
                               onchange="updateBetAmount(${index}, this.value)"
                               placeholder="Bet amount">
                    </div>
                `).join('');
            }
            
            updateBetSlipSummary();
        }
        
        function updateBetSlipSummary() {
            const total = betSlip.reduce((sum, bet) => sum + (bet.amount || 0), 0);
            const remaining = 20 - total;
            
            document.getElementById('betCountSummary').textContent = `${betSlip.length}/5`;
            document.getElementById('totalWagered').textContent = `${total.toFixed(2)}`;
            document.getElementById('remainingAmount').textContent = `${remaining.toFixed(2)}`;
        }
        
        function validateBets() {
            const total = betSlip.reduce((sum, bet) => sum + (bet.amount || 0), 0);
            const submitBtn = document.getElementById('submitBtn');
            const validationMessage = document.getElementById('validationMessage');
            
            let isValid = true;
            let message = '';
            
            if (betSlip.length < 3) {
                isValid = false;
                message = 'Select at least 3 games to bet on';
            } else if (total !== 20) {
                isValid = false;
                if (total < 20) {
                    message = `Add ${(20 - total).toFixed(2)} more to reach $20 total`;
                } else {
                    message = `Remove ${(total - 20).toFixed(2)} to reach $20 total`;
                }
            } else if (betSlip.some(bet => (bet.amount || 0) < 3)) {
                isValid = false;
                message = 'All bets must be at least $3';
            }
            
            submitBtn.disabled = !isValid;
            
            if (message) {
                validationMessage.textContent = message;
                validationMessage.classList.remove('hidden');
            } else {
                validationMessage.classList.add('hidden');
            }
        }
        
        function showValidationMessage(message) {
            const validationMessage = document.getElementById('validationMessage');
            validationMessage.textContent = message;
            validationMessage.classList.remove('hidden');
            setTimeout(() => {
                validationMessage.classList.add('hidden');
            }, 3000);
        }
        
        function clearAllSelections() {
            document.querySelectorAll('.bet-option.selected').forEach(option => {
                option.classList.remove('selected');
            });
        }
        
        // Bet Slip Modal
        function openBetSlip() {
            if (betSlip.length > 0) {
                document.getElementById('betSlipModal').style.display = 'block';
            }
        }
        
        function closeBetSlip() {
            document.getElementById('betSlipModal').style.display = 'none';
        }
        
        // Submit Bets
        async function submitBets() {
            if (!currentUser || !supabase) return;
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                // Get current active week
                const { data: weekData } = await supabase
                    .from('betting_weeks')
                    .select('id')
                    .eq('is_active', true)
                    .single();
                
                if (!weekData) {
                    throw new Error('No active betting week found');
                }
                
                // Delete existing bets for this week
                await supabase
                    .from('user_bets')
                    .delete()
                    .eq('user_pin', currentUser.pin)
                    .eq('week_id', weekData.id);
                
                // Insert new bets
                const betsToInsert = betSlip.map(bet => ({
                    user_pin: currentUser.pin,
                    week_id: weekData.id,
                    game_id: bet.gameId,
                    team_picked: bet.team,
                    bet_amount: bet.amount,
                    odds: bet.odds,
                    bet_type: bet.type
                }));
                
                const { error } = await supabase
                    .from('user_bets')
                    .insert(betsToInsert);
                
                if (error) throw error;
                
                // Show success message
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.textContent = `Successfully submitted ${betSlip.length} bets totaling $20.00!`;
                document.getElementById('betSlipItems').prepend(successDiv);
                
                // Clear bet slip after short delay
                setTimeout(() => {
                    betSlip = [];
                    clearAllSelections();
                    updateBetSlip();
                    closeBetSlip();
                }, 2000);
                
            } catch (err) {
                showValidationMessage('Failed to submit bets: ' + err.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Bets';
            }
        }
        
        // Admin Functions
        async function loadOdds() {
            if (!currentUser?.is_admin) return;
            
            const weekNumber = prompt('Enter week number (1-15):');
            if (!weekNumber || isNaN(weekNumber) || weekNumber < 1 || weekNumber > 15) {
                alert('Please enter a valid week number between 1 and 15');
                return;
            }
            
            const btn = document.getElementById('loadOddsBtn');
            btn.disabled = true;
            btn.textContent = 'Loading Odds...';
            
            try {
                // Fetch odds from API
                const response = await fetch(
                    `https://api.the-odds-api.com/v4/sports/americanfootball_ncaaf/odds/?apiKey=${ODDS_API_KEY}&regions=us&markets=h2h,spreads,totals&oddsFormat=american&bookmakers=fanduel,draftkings`
                );
                
                if (!response.ok) throw new Error('Failed to fetch odds');
                
                const oddsData = await response.json();
                
                // Deactivate previous weeks
                await supabase
                    .from('betting_weeks')
                    .update({ is_active: false })
                    .neq('id', 0); // Update all
                
                // Create new betting week
                const deadline = new Date();
                deadline.setDate(deadline.getDate() + ((5 - deadline.getDay() + 7) % 7)); // Next Friday
                deadline.setHours(11, 0, 0, 0); // 11 AM ET
                
                const { data: newWeek, error } = await supabase
                    .from('betting_weeks')
                    .insert([{
                        week_number: parseInt(weekNumber),
                        year: 2025,
                        api_data: { games: oddsData },
                        betting_deadline: deadline.toISOString(),
                        is_active: true
                    }])
                    .select();
                
                if (error) throw error;
                
                currentWeek = newWeek[0];
                
                // Update UI with new games
                updateGamesDisplay(oddsData.slice(0, 10)); // Show first 10 games
                
                alert(`Successfully loaded odds for Week ${weekNumber}! Found ${oddsData.length} games.`);
                
            } catch (err) {
                alert('Failed to load odds: ' + err.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Load Odds';
            }
        }
        
        function updateGamesDisplay(games) {
            const container = document.getElementById('gamesContainer');
            
            container.innerHTML = games.map((game, index) => {
                const gameId = `game${index + 1}`;
                const homeTeam = game.home_team;
                const awayTeam = game.away_team;
                const gameTime = new Date(game.commence_time).toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit'
                });
                
                // Get odds from first bookmaker
                const bookmaker = game.bookmakers?.[0];
                if (!bookmaker) return '';
                
                const h2hMarket = bookmaker.markets?.find(m => m.key === 'h2h');
                const spreadMarket = bookmaker.markets?.find(m => m.key === 'spreads');
                const totalMarket = bookmaker.markets?.find(m => m.key === 'totals');
                
                const awayML = h2hMarket?.outcomes?.find(o => o.name === awayTeam)?.price || 'N/A';
                const homeML = h2hMarket?.outcomes?.find(o => o.name === homeTeam)?.price || 'N/A';
                
                const awaySpread = spreadMarket?.outcomes?.find(o => o.name === awayTeam);
                const homeSpread = spreadMarket?.outcomes?.find(o => o.name === homeTeam);
                
                const overTotal = totalMarket?.outcomes?.find(o => o.name === 'Over');
                const underTotal = totalMarket?.outcomes?.find(o => o.name === 'Under');
                
                return `
                    <div class="game-card">
                        <div class="game-header">
                            <div class="game-matchup">${awayTeam} @ ${homeTeam}</div>
                            <div class="game-time">${gameTime}</div>
                        </div>
                        
                        <div class="team-row">
                            <div class="team-name">${awayTeam}</div>
                            <div class="bet-option" onclick="selectBet('${gameId}', '${awayTeam}', 'moneyline', '${awayML > 0 ? '+' + awayML : awayML}')" data-bet="${gameId}-${awayTeam.toLowerCase().replace(/\s+/g, '')}-moneyline">${awayML > 0 ? '+' + awayML : awayML}</div>
                            <div class="bet-option" onclick="selectBet('${gameId}', '${awayTeam}', 'spread', '${awaySpread?.point > 0 ? '+' : ''}${awaySpread?.point} (${awaySpread?.price > 0 ? '+' : ''}${awaySpread?.price})')" data-bet="${gameId}-${awayTeam.toLowerCase().replace(/\s+/g, '')}-spread">${awaySpread?.point > 0 ? '+' : ''}${awaySpread?.point}</div>
                            <div class="bet-option" onclick="selectBet('${gameId}', 'Over', 'total', 'O${overTotal?.point} (${overTotal?.price > 0 ? '+' : ''}${overTotal?.price})')" data-bet="${gameId}-over">O${overTotal?.point}</div>
                        </div>
                        
                        <div class="team-row">
                            <div class="team-name">${homeTeam}</div>
                            <div class="bet-option" onclick="selectBet('${gameId}', '${homeTeam}', 'moneyline', '${homeML > 0 ? '+' + homeML : homeML}')" data-bet="${gameId}-${homeTeam.toLowerCase().replace(/\s+/g, '')}-moneyline">${homeML > 0 ? '+' + homeML : homeML}</div>
                            <div class="bet-option" onclick="selectBet('${gameId}', '${homeTeam}', 'spread', '${homeSpread?.point > 0 ? '+' : ''}${homeSpread?.point} (${homeSpread?.price > 0 ? '+' : ''}${homeSpread?.price})')" data-bet="${gameId}-${homeTeam.toLowerCase().replace(/\s+/g, '')}-spread">${homeSpread?.point > 0 ? '+' : ''}${homeSpread?.point}</div>
                            <div class="bet-option" onclick="selectBet('${gameId}', 'Under', 'total', 'U${underTotal?.point} (${underTotal?.price > 0 ? '+' : ''}${underTotal?.price})')" data-bet="${gameId}-under">U${underTotal?.point}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Initialize bet slip display
        updateBetSlip();
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('betSlipModal');
            if (event.target === modal) {
                closeBetSlip();
            }
        }
    </script>
</body>
</html>
